// ✅ prisma/schema.prisma - VERIFICAR que tengas EXACTAMENTE esto

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Provider {
  id           String        @id @default(uuid())
  name         String
  slug         String        @unique
  email        String?
  quoteConfigs QuoteConfig[] // ✅ DEBE ESTAR AQUÍ
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt

  @@map("providers")
}

model QuoteConfig {
  id         String    @id @default(uuid())
  providerId String
  type       QuoteType
  isActive   Boolean   @default(true)

  provider    Provider     @relation(fields: [providerId], references: [id], onDelete: Cascade)
  solarConfig SolarConfig? // ✅ DEBE ESTAR AQUÍ

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([providerId, type])
  @@map("quote_configs")
}

model SolarConfig {
  id            String      @id @default(uuid())
  quoteConfigId String      @unique
  quoteConfig   QuoteConfig @relation(fields: [quoteConfigId], references: [id], onDelete: Cascade)

  // Residencial
  residentialEnergyCost    Float @default(0.15)
  residentialFixedCharge   Float @default(10)
  residentialTaxRate       Float @default(21)
  residentialInflationRate Float @default(4)

  // Industrial
  industrialEnergyCost    Float  @default(0.12)
  industrialFixedCharge   Float  @default(50)
  industrialDemandCharge  Float? @default(15)
  industrialTaxRate       Float  @default(21)
  industrialInflationRate Float  @default(4)

  // Agro
  agroEnergyCost    Float @default(0.13)
  agroFixedCharge   Float @default(30)
  agroTaxRate       Float @default(10.5)
  agroInflationRate Float @default(4)

  // Sistema
  panelPower      Int   @default(550)
  panelEfficiency Float @default(21)
  systemLosses    Float @default(15)
  degradationRate Float @default(0.5)

  peakSunHoursDay   Float @default(6)
  peakSunHoursNight Float @default(0)
  peakSunHoursMixed Float @default(5)

  // Costos
  panelCost             Float @default(200)
  inverterCost          Float @default(500)
  inverterCostPerKw     Float @default(300)
  installationCostPerKw Float @default(150)
  structureCostPerKw    Float @default(100)
  marginPercentage      Float @default(20)

  mountingCostRoofSheet Float @default(50)
  mountingCostRoofTile  Float @default(80)
  mountingCostGround    Float @default(120)
  mountingCostCarport   Float @default(150)

  // Financiamiento
  financingEnabled      Boolean @default(true)
  downPaymentPercentage Float   @default(20)
  interestRate          Float   @default(8)
  termMonths            Int     @default(60)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("solar_configs")
}

enum QuoteType {
  SOLAR
  GYM
}
